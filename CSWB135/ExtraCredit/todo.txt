solve problem
add comments
use fancy replace mechanism

